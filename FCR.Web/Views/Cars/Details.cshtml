@model FCR.Web.Services.Base.CarResponseDto

@{
	ViewData["Title"] = $"{Model.Brand} {Model.Model} - Details";
}

<!-- Car Details Section -->
<section class="py-12 bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen">
	<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">

		<!-- Breadcrumb -->
		<nav class="mb-8">
			<ol class="flex items-center space-x-2 text-sm">
				<li>
					<a asp-controller="Home" asp-action="Index" class="text-primary-600 hover:text-primary-800 font-medium">
						<i class="fas fa-home mr-1"></i>Home
					</a>
				</li>
				<li class="text-gray-400">/</li>
				<li>
					<a asp-action="Index" class="text-primary-600 hover:text-primary-800 font-medium">Cars</a>
				</li>
				<li class="text-gray-400">/</li>
				<li class="text-gray-600 font-semibold">@Model.Brand @Model.Model</li>
			</ol>
		</nav>

		<!-- Main Content Grid -->
		<div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

			<!-- Left Column - Images (2/3 width) -->
			<div class="lg:col-span-2">

				<!-- Image Gallery Card -->
				<div class="bg-white rounded-3xl shadow-xl overflow-hidden mb-8">
					@if (Model.Images != null && Model.Images.Any())
					{
						var imagesList = Model.Images.ToList(); // Convert to List for easier indexing

						<!-- Main Image Display -->
						<div class="relative bg-gray-900" style="height: 500px;">
							<div id="mainImageContainer" class="w-full h-full">
								@for (int i = 0; i < imagesList.Count; i++)
								{
									<div class="gallery-item @(i == 0 ? "" : "hidden") w-full h-full" data-index="@i">
										<img src="@imagesList[i].Url"
											 alt="@imagesList[i].AltText"
											 class="w-full h-full object-contain">
									</div>
								}
							</div>

							<!-- Navigation Arrows -->
							@if (imagesList.Count > 1)
							{
								<button type="button"
										id="prevBtn"
										class="absolute top-1/2 left-4 -translate-y-1/2 w-12 h-12 bg-white/90 hover:bg-white rounded-full flex items-center justify-center transition-all duration-300 shadow-lg z-10">
									<i class="fas fa-chevron-left text-gray-800"></i>
								</button>

								<button type="button"
										id="nextBtn"
										class="absolute top-1/2 right-4 -translate-y-1/2 w-12 h-12 bg-white/90 hover:bg-white rounded-full flex items-center justify-center transition-all duration-300 shadow-lg z-10">
									<i class="fas fa-chevron-right text-gray-800"></i>
								</button>

								<!-- Image Counter -->
								<div class="absolute bottom-4 right-4 px-4 py-2 bg-black/70 text-white rounded-full text-sm font-semibold">
									<span id="imageCounter">1</span> / @imagesList.Count
								</div>
							}
						</div>

						<!-- Thumbnail Gallery -->
						@if (imagesList.Count > 1)
						{
							<div class="p-4 bg-gray-50">
								<div class="grid grid-cols-4 md:grid-cols-6 gap-3">
									@for (int i = 0; i < imagesList.Count; i++)
									{
										<button type="button"
												class="thumbnail-btn @(i == 0 ? "ring-4 ring-primary-500" : "ring-2 ring-gray-200 hover:ring-primary-300") rounded-xl overflow-hidden transition-all duration-300 aspect-video"
												data-index="@i"
												onclick="showImage(@i)">
											<img src="@imagesList[i].Url"
												 alt="Thumbnail @(i + 1)"
												 class="w-full h-full object-cover">
										</button>
									}
								</div>
							</div>
						}
					}
					else
					{
						<div class="h-96 bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center">
							<div class="text-center">
								<i class="fas fa-image text-gray-400 text-6xl mb-4"></i>
								<p class="text-gray-500 text-lg">No images available</p>
							</div>
						</div>
					}
				</div>

				<!-- Description Card -->
				<div class="bg-white rounded-3xl shadow-xl p-8">
					<h2 class="text-2xl font-bold text-gray-900 mb-6 flex items-center">
						<i class="fas fa-file-alt text-primary-500 mr-3"></i>
						About This Vehicle
					</h2>
					<p class="text-gray-700 text-lg leading-relaxed">
						Experience the perfect blend of luxury and performance with the <strong>@Model.Brand @Model.Model</strong>.
						This @Model.Year @Model.Category features @Model.Transmission transmission, runs on @Model.FuelType,
						and comfortably seats @Model.Seats passengers. Perfect for any occasion, whether it's a business trip,
						family vacation, or special event.
					</p>

					<div class="mt-6 grid grid-cols-2 md:grid-cols-4 gap-4">
						<div class="text-center p-4 bg-blue-50 rounded-xl">
							<i class="fas fa-shield-alt text-blue-600 text-2xl mb-2"></i>
							<p class="text-xs text-gray-600">Fully Insured</p>
						</div>
						<div class="text-center p-4 bg-green-50 rounded-xl">
							<i class="fas fa-tools text-green-600 text-2xl mb-2"></i>
							<p class="text-xs text-gray-600">Well Maintained</p>
						</div>
						<div class="text-center p-4 bg-purple-50 rounded-xl">
							<i class="fas fa-headset text-purple-600 text-2xl mb-2"></i>
							<p class="text-xs text-gray-600">24/7 Support</p>
						</div>
						<div class="text-center p-4 bg-orange-50 rounded-xl">
							<i class="fas fa-sparkles text-orange-600 text-2xl mb-2"></i>
							<p class="text-xs text-gray-600">Cleaned Daily</p>
						</div>
					</div>
				</div>

			</div>

			<!-- Right Column - Details & Booking (1/3 width) -->
			<div class="lg:col-span-1">

				<!-- Title Card -->
				<div class="bg-white rounded-3xl shadow-xl p-8 mb-6">
					<div class="mb-6">
						<h1 class="text-4xl font-black text-gray-900 mb-2">
							@Model.Brand
						</h1>
						<h2 class="text-3xl font-bold text-primary-600 mb-4">
							@Model.Model
						</h2>
						<div class="flex items-center gap-3">
							<span class="px-4 py-2 bg-primary-100 text-primary-700 rounded-full font-bold text-sm">
								@Model.Category
							</span>
							@if (Model.IsAvailable)
							{
								<span class="px-4 py-2 bg-green-100 text-green-700 rounded-full font-bold text-sm">
									<i class="fas fa-check-circle mr-1"></i>Available
								</span>
							}
							else
							{
								<span class="px-4 py-2 bg-red-100 text-red-700 rounded-full font-bold text-sm">
									<i class="fas fa-times-circle mr-1"></i>Unavailable
								</span>
							}
						</div>
					</div>

					<!-- Price -->
					<div class="bg-gradient-to-br from-primary-50 to-blue-50 rounded-2xl p-6 border-2 border-primary-200">
						<p class="text-gray-600 text-sm mb-2">Starting from</p>
						<p class="text-5xl font-black text-primary-600 mb-1">
							$@Model.DailyRate
						</p>
						<p class="text-gray-600">per day</p>
					</div>
				</div>

				<!-- Specifications Card -->
				<div class="bg-white rounded-3xl shadow-xl p-8 mb-6 sticky top-24">
					<h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center">
						<i class="fas fa-cogs text-primary-500 mr-3"></i>
						Specifications
					</h3>

					<div class="space-y-4">
						<div class="flex items-center justify-between py-3 border-b border-gray-200">
							<div class="flex items-center">
								<i class="fas fa-calendar text-primary-500 w-6 mr-3"></i>
								<span class="text-gray-700 font-medium">Year</span>
							</div>
							<span class="font-bold text-gray-900">@Model.Year</span>
						</div>

						<div class="flex items-center justify-between py-3 border-b border-gray-200">
							<div class="flex items-center">
								<i class="fas fa-gas-pump text-primary-500 w-6 mr-3"></i>
								<span class="text-gray-700 font-medium">Fuel Type</span>
							</div>
							<span class="font-bold text-gray-900">@Model.FuelType</span>
						</div>

						<div class="flex items-center justify-between py-3 border-b border-gray-200">
							<div class="flex items-center">
								<i class="fas fa-cog text-primary-500 w-6 mr-3"></i>
								<span class="text-gray-700 font-medium">Transmission</span>
							</div>
							<span class="font-bold text-gray-900">@Model.Transmission</span>
						</div>

						<div class="flex items-center justify-between py-3">
							<div class="flex items-center">
								<i class="fas fa-users text-primary-500 w-6 mr-3"></i>
								<span class="text-gray-700 font-medium">Seats</span>
							</div>
							<span class="font-bold text-gray-900">@Model.Seats</span>
						</div>
					</div>

					<!-- Action Buttons -->
					<div class="mt-8 space-y-3">
						@if (Model.IsAvailable)
						{
							<a asp-controller="Bookings" asp-action="Create" asp-route-carId="@Model.CarId"
							   class="block w-full px-6 py-4 bg-gradient-to-r from-primary-500 to-primary-700 hover:from-primary-600 hover:to-primary-800 text-white rounded-xl font-bold text-center transform hover:scale-105 transition-all duration-300 shadow-lg hover:shadow-2xl">
								<i class="fas fa-calendar-check mr-2"></i>
								Book Now
							</a>
						}
						else
						{
							<button disabled
									class="block w-full px-6 py-4 bg-gray-300 text-gray-500 rounded-xl font-bold text-center cursor-not-allowed">
								<i class="fas fa-ban mr-2"></i>
								Currently Unavailable
							</button>
						}

						<a asp-action="Index"
						   class="block w-full px-6 py-4 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-xl font-bold text-center transform hover:scale-105 transition-all duration-300">
							<i class="fas fa-arrow-left mr-2"></i>
							Back to Fleet
						</a>

						@if (User.IsInRole("Admin"))
						{
							<div class="pt-4 border-t border-gray-200 space-y-2">
								<a asp-action="Edit" asp-route-id="@Model.CarId"
								   class="block w-full px-4 py-3 bg-blue-500 hover:bg-blue-600 text-white rounded-xl font-semibold text-center transition-all">
									<i class="fas fa-edit mr-2"></i>Edit
								</a>
								<a asp-action="Delete" asp-route-id="@Model.CarId"
								   class="block w-full px-4 py-3 bg-red-500 hover:bg-red-600 text-white rounded-xl font-semibold text-center transition-all">
									<i class="fas fa-trash mr-2"></i>Delete
								</a>
							</div>
						}
					</div>
				</div>

				<!-- Contact Card -->
				<div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-2xl p-6 border-2 border-blue-200">
					<h4 class="text-lg font-bold text-gray-900 mb-3 flex items-center">
						<i class="fas fa-question-circle text-blue-600 mr-2"></i>
						Have Questions?
					</h4>
					<p class="text-gray-700 text-sm mb-4">
						Our team is here to help you find the perfect vehicle for your needs.
					</p>
					<a asp-controller="Home" asp-action="Contact"
					   class="inline-flex items-center text-blue-600 hover:text-blue-800 font-bold text-sm">
						<i class="fas fa-headset mr-2"></i>
						Contact Us
					</a>
				</div>

			</div>

		</div>

	</div>
</section>

@section Scripts {
	<script>
		let currentIndex = 0;
		const totalImages = @(Model.Images?.Count ?? 0);

		function showImage(index) {
			if (totalImages === 0) return;

			// Update index
			currentIndex = index;

			// Hide all images
			document.querySelectorAll('.gallery-item').forEach(item => {
				item.classList.add('hidden');
			});

			// Show current image
			document.querySelector(`.gallery-item[data-index="${index}"]`).classList.remove('hidden');

			// Update counter
			document.getElementById('imageCounter').textContent = index + 1;

			// Update thumbnail highlights
			document.querySelectorAll('.thumbnail-btn').forEach(btn => {
				btn.classList.remove('ring-4', 'ring-primary-500');
				btn.classList.add('ring-2', 'ring-gray-200');
			});
			document.querySelector(`.thumbnail-btn[data-index="${index}"]`)?.classList.remove('ring-2', 'ring-gray-200');
			document.querySelector(`.thumbnail-btn[data-index="${index}"]`)?.classList.add('ring-4', 'ring-primary-500');
		}

		// Previous button
		document.getElementById('prevBtn')?.addEventListener('click', () => {
			if (currentIndex > 0) {
				showImage(currentIndex - 1);
			}
		});

		// Next button
		document.getElementById('nextBtn')?.addEventListener('click', () => {
			if (currentIndex < totalImages - 1) {
				showImage(currentIndex + 1);
			}
		});

		// Keyboard navigation
		document.addEventListener('keydown', (e) => {
			if (e.key === 'ArrowLeft' && currentIndex > 0) {
				showImage(currentIndex - 1);
			} else if (e.key === 'ArrowRight' && currentIndex < totalImages - 1) {
				showImage(currentIndex + 1);
			}
		});
	</script>
}